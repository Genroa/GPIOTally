<head>
	<title>GPIOTally</title>
</head>

<body>

	<nav id="navmenu" class="navmenu navmenu-default navmenu-fixed-left offcanvas" role="navigation">
		<div class="navmenu-brand">
			Configuration
		</div>
		<span class="menu-span">Remplacer la configuration actuelle par la configuration :</span>
		{{> configurationList}}
		<a href="" class="btn btn-default btn-fab"><i class="material-icons">grade</i></a>
	</nav>
	<div class="navbar navbar-default navbar-fixed-top">
		<div class="navbar-left navbar-header">
		  	<button type="button" class="nav navbar-menu btn btn-lg btn-link" data-toggle="offcanvas" data-target="#navmenu" data-canvas="body">
		    	<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
		  	</button>
		</div>
		<a class="navbar-brand" href="#">GPIOTally</a>
	</div>
	{{> grid}}
</body>

<template name="grid">
	<div id="container">
		{{#if Template.subscriptionsReady}}

			<div>{{getInputNumber}} entrées, {{getOutputNumber}} sorties:</div>
			<div>Configuration actuelle : {{getCurrentConfigurationName}}</div>
			<!-- Pour chaque index dans range, générer la colone et les lignes dédiées à cette entrée dans le SVG -->
			<svg id="svgGrid" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 {{defineSvgWidth}} {{defineSvgWidth}}" style="height: {{defineSvgHeight}}px">
				<!-- Drawing grid with names -->
				{{#each column in inputsRange}}
					<text text-anchor="middle" transform="rotate(280, {{textPosition column}}, 50)" x="{{columnPosition column}}" y="50">{{getInputName @index}}</text>
					<rect class="wire_{{column}}_vert" x="{{columnPosition column}}" y="{{getNameSpace}}" width="{{gridThickness}}" height="{{columnHeight}}" fill="darkgrey" stroke="darkgrey"/>
				{{/each}}
				{{#each line in outputsRange}}
					<rect class="wire_{{line}}_hor" x="10" y="{{linePosition line}}" width="{{lineLength}}" height="{{gridThickness}}" fill="darkgrey" stroke="darkgrey"/>
				{{/each}}

				<!-- Building connection lines -->
				{{#each column in getCurrentGridConnections}}
					{{#let columnIndex=@index}}
						{{#each out in column}}
							{{#if $eq out 1 }}
								{{{buildConnectionLine columnIndex @index}}}
							{{/if}}
						{{/each}}
					{{/let}}
				{{/each}}
			</svg>
		{{else}}
			Chargement des données...
		{{/if}}
	</div>
</template>

<template name="configurationList">
	<ul class="nav navmenu-nav">
		{{#each config in configurations}}
			<li><a href="#">{{config.name}}</a></li>
		{{/each}}
	</ul>
</template>